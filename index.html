<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Garner Badminton Â· Community Gyms</title>
<style>
/* â”€â”€ Google Font â”€â”€ */
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');

/* â”€â”€ Design Tokens â”€â”€ */
:root {
  --saffron:      #F4A100;
  --saffron-light:#FFD166;
  --saffron-glow: rgba(244,161,0,0.25);
  --saffron-soft: rgba(244,161,0,0.08);
  --ink:          #0D0D0D;
  --ink-2:        #1A1A1A;
  --ink-3:        #2B2B2B;
  --muted:        #6B6B6B;
  --muted-2:      #8C8C8C;
  --divider:      rgba(255,255,255,0.08);
  --surface:      #161616;
  --surface-2:    #1E1E1E;
  --surface-3:    #252525;
  --open-bg:      rgba(34,197,94,0.1);
  --open-border:  rgba(34,197,94,0.3);
  --open-text:    #4ade80;
  --taken-bg:     rgba(239,68,68,0.1);
  --taken-border: rgba(239,68,68,0.25);
  --taken-text:   #f87171;
  --radius-sm:    8px;
  --radius:       14px;
  --radius-lg:    20px;
  --shadow:       0 4px 24px rgba(0,0,0,0.4);
  --shadow-glow:  0 0 40px rgba(244,161,0,0.15);
}

/* â”€â”€ Reset â”€â”€ */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth}
body{
  font-family:'Inter',system-ui,sans-serif;
  background:var(--ink);
  color:#E8E8E8;
  min-height:100vh;
  -webkit-font-smoothing:antialiased;
}

/* â”€â”€ Scrollbar â”€â”€ */
::-webkit-scrollbar{width:6px;height:6px}
::-webkit-scrollbar-track{background:var(--ink-2)}
::-webkit-scrollbar-thumb{background:var(--ink-3);border-radius:3px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HERO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.hero{
  position:relative;overflow:hidden;
  padding:72px 24px 80px;text-align:center;
  background:var(--ink);
}
.hero::before{
  content:'';position:absolute;inset:0;
  background:
    radial-gradient(ellipse 70% 60% at 50% -10%, rgba(244,161,0,0.18) 0%, transparent 70%),
    radial-gradient(ellipse 40% 40% at 80% 80%, rgba(244,161,0,0.06) 0%, transparent 60%);
  pointer-events:none;
}
.hero::after{
  content:'ğŸ¸';position:absolute;right:-20px;bottom:-30px;
  font-size:220px;opacity:.04;transform:rotate(25deg);pointer-events:none;
}
.hero-eyebrow{
  display:inline-flex;align-items:center;gap:6px;
  font-size:.7rem;font-weight:600;letter-spacing:2px;text-transform:uppercase;
  color:var(--saffron);border:1px solid rgba(244,161,0,0.35);
  background:rgba(244,161,0,0.08);border-radius:50px;padding:5px 14px;margin-bottom:24px;
}
.hero h1{font-size:clamp(2.2rem,6vw,3.8rem);font-weight:900;letter-spacing:-1.5px;line-height:1.05;color:#fff;}
.hero h1 span{color:var(--saffron)}
.hero-sub{margin-top:14px;font-size:1rem;color:var(--muted-2);font-weight:400;max-width:480px;margin-left:auto;margin-right:auto;}
.hero-pills{display:flex;justify-content:center;gap:10px;flex-wrap:wrap;margin-top:28px;}
.pill{display:flex;align-items:center;gap:6px;font-size:.78rem;font-weight:500;color:#B0B0B0;background:var(--surface);border:1px solid var(--divider);border-radius:50px;padding:6px 14px;}
.pill-dot{width:6px;height:6px;border-radius:50%;background:var(--saffron)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LAYOUT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.page{max-width:1000px;margin:0 auto;padding:0 20px 100px}
.section-label{font-size:.68rem;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--saffron);margin-bottom:10px;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WEEK TABS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.tabs-container{position:sticky;top:0;z-index:50;background:rgba(13,13,13,0.85);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-bottom:1px solid var(--divider);padding:12px 20px;}
.tabs-scroll{display:flex;gap:6px;overflow-x:auto;scrollbar-width:none;max-width:1000px;margin:0 auto;}
.tabs-scroll::-webkit-scrollbar{display:none}
.tab-btn{flex:none;padding:8px 18px;font-size:.8rem;font-weight:600;font-family:'Inter',sans-serif;background:var(--surface-2);border:1px solid var(--divider);border-radius:50px;color:var(--muted);cursor:pointer;white-space:nowrap;transition:all .2s ease;}
.tab-btn:hover{color:#E8E8E8;border-color:rgba(255,255,255,0.15);background:var(--surface-3)}
.tab-btn.active{background:var(--saffron);border-color:var(--saffron);color:var(--ink);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PANELS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.week-panel{display:none}
.week-panel.active{display:block}
.week-header{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px;padding:32px 0 20px;}
.week-header-title{font-size:1.35rem;font-weight:800;letter-spacing:-.5px;color:#fff}
.week-header-sub{font-size:.82rem;color:var(--muted);margin-top:2px}

/* â”€â”€ Day section â”€â”€ */
.day-section{margin-bottom:20px}
.day-card{border-radius:var(--radius-lg);overflow:hidden;border:1px solid var(--divider);background:var(--surface);box-shadow:0 2px 16px rgba(0,0,0,0.3);transition:box-shadow .2s;}
.day-card:hover{box-shadow:0 4px 24px rgba(0,0,0,0.4)}
.day-head{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px;padding:16px 22px;background:var(--surface-2);border-bottom:1px solid var(--divider);}
.day-head-left{display:flex;align-items:center;gap:12px}
.day-dot{width:36px;height:36px;border-radius:10px;background:var(--saffron-soft);border:1px solid rgba(244,161,0,0.25);display:flex;align-items:center;justify-content:center;font-size:1rem;flex-shrink:0;}
.day-name{font-size:.98rem;font-weight:700;color:#fff;letter-spacing:-.2px}
.day-date-str{font-size:.78rem;color:var(--muted);margin-top:1px}
.day-time-badge{font-size:.74rem;font-weight:600;background:rgba(244,161,0,0.12);color:var(--saffron);border:1px solid rgba(244,161,0,0.25);border-radius:50px;padding:4px 12px;white-space:nowrap;}

/* â”€â”€ Slots table â”€â”€ */
.slots-table{width:100%;border-collapse:collapse}
.slots-table th{padding:10px 16px;font-size:.68rem;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--muted);text-align:center;border-bottom:1px solid var(--divider);}
.slots-table th:first-child{text-align:left}
.slots-table td{padding:10px 12px;border-bottom:1px solid rgba(255,255,255,0.04);vertical-align:middle;}
.slots-table tr:last-child td{border-bottom:none}
.slots-table td:first-child{font-size:.8rem;font-weight:600;color:var(--muted-2);white-space:nowrap;padding-left:20px;font-variant-numeric:tabular-nums;}
.slots-table td:not(:first-child){text-align:center}

/* â”€â”€ Slot button â”€â”€ */
.slot-btn{display:inline-flex;align-items:center;justify-content:center;gap:6px;width:100%;max-width:200px;padding:9px 14px;border-radius:var(--radius-sm);font-size:.78rem;font-weight:600;font-family:'Inter',sans-serif;border:1.5px solid;cursor:pointer;transition:all .15s ease;line-height:1;white-space:nowrap;}
.slot-open{background:var(--open-bg);border-color:var(--open-border);color:var(--open-text);}
.slot-open:hover{background:rgba(34,197,94,0.18);border-color:rgba(34,197,94,0.5);transform:translateY(-1px);box-shadow:0 4px 12px rgba(34,197,94,0.15);}
.slot-open::before{content:'';width:7px;height:7px;border-radius:50%;background:var(--open-text);flex-shrink:0}
.slot-taken{background:var(--taken-bg);border-color:var(--taken-border);color:var(--taken-text);cursor:default;}
.slot-taken::before{content:'';width:7px;height:7px;border-radius:50%;background:var(--taken-text);flex-shrink:0}
/* cancel button (tiny, below taken cell) */
.btn-cancel-slot{
  display:block;margin:4px auto 0;
  background:none;border:none;
  font-size:.68rem;color:var(--muted);
  cursor:pointer;font-family:'Inter',sans-serif;
  text-decoration:underline;text-underline-offset:2px;
  transition:color .15s;
}
.btn-cancel-slot:hover{color:#f87171}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INFO BANNER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.info-banner{display:flex;gap:14px;align-items:flex-start;background:var(--saffron-soft);border:1px solid rgba(244,161,0,0.2);border-radius:var(--radius);padding:16px 20px;margin:24px 0;font-size:.85rem;color:#C8C8C8;line-height:1.6;}
.info-banner-icon{font-size:1.2rem;flex-shrink:0;margin-top:1px}
.info-banner a{color:var(--saffron);text-decoration:none}
.info-banner a:hover{text-decoration:underline}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LEGEND
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.legend{display:flex;align-items:center;gap:20px;flex-wrap:wrap;margin-bottom:24px;}
.legend-item{display:flex;align-items:center;gap:7px;font-size:.78rem;color:var(--muted);font-weight:500;}
.legend-pip{width:10px;height:10px;border-radius:50%;border:1.5px solid;flex-shrink:0;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EMPTY STATES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.empty-week{text-align:center;padding:72px 24px;color:var(--muted);}
.empty-icon{font-size:52px;margin-bottom:16px;opacity:.5}
.empty-week h3{font-size:1.1rem;font-weight:700;color:#888;margin-bottom:6px}
.empty-week p{font-size:.88rem;line-height:1.6}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ADMIN FAB
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.fab{position:fixed;bottom:28px;right:28px;z-index:100;display:flex;align-items:center;gap:8px;padding:13px 22px;border-radius:50px;background:var(--saffron);color:var(--ink);font-size:.85rem;font-weight:700;font-family:'Inter',sans-serif;border:none;cursor:pointer;box-shadow:0 4px 24px rgba(244,161,0,0.4);transition:all .2s ease;letter-spacing:.2px;}
.fab:hover{transform:translateY(-2px);box-shadow:0 8px 32px rgba(244,161,0,0.5);}
.fab-icon{font-size:1rem}
.admin-unlocked .fab{background:#E8E8E8}
.admin-unlocked .fab::after{content:'âœ“';width:18px;height:18px;border-radius:50%;background:var(--saffron);color:var(--ink);font-size:.7rem;font-weight:900;display:flex;align-items:center;justify-content:center;}
.btn-add-slot{display:none;align-items:center;gap:6px;padding:9px 18px;border-radius:var(--radius-sm);background:transparent;border:1.5px solid rgba(244,161,0,0.4);color:var(--saffron);font-size:.82rem;font-weight:600;font-family:'Inter',sans-serif;cursor:pointer;transition:all .15s;}
.btn-add-slot:hover{background:var(--saffron-soft)}
.admin-unlocked .btn-add-slot{display:flex}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODALS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.overlay{display:none;position:fixed;inset:0;z-index:200;background:rgba(0,0,0,0.75);backdrop-filter:blur(6px);align-items:center;justify-content:center;padding:16px;}
.overlay.open{display:flex}
.modal{background:var(--surface-2);border:1px solid var(--divider);border-radius:var(--radius-lg);box-shadow:0 24px 80px rgba(0,0,0,0.6);width:100%;max-width:480px;max-height:90vh;overflow-y:auto;animation:slideUp .22s cubic-bezier(.34,1.56,.64,1);}
.modal-sm{max-width:380px}
@keyframes slideUp{from{transform:translateY(24px) scale(.97);opacity:0}to{transform:translateY(0) scale(1);opacity:1}}
.modal-head{display:flex;align-items:center;justify-content:space-between;padding:20px 24px 16px;border-bottom:1px solid var(--divider);}
.modal-head h2{font-size:1rem;font-weight:700;color:#fff;letter-spacing:-.2px}
.modal-close{background:var(--surface-3);border:none;width:30px;height:30px;border-radius:8px;display:flex;align-items:center;justify-content:center;color:var(--muted);font-size:1rem;cursor:pointer;transition:background .15s;}
.modal-close:hover{background:rgba(255,255,255,.1);color:#fff}
.modal-body{padding:22px 24px}
.fgroup{margin-bottom:18px}
.fgroup label{display:block;font-size:.75rem;font-weight:600;color:var(--muted-2);letter-spacing:.4px;text-transform:uppercase;margin-bottom:7px;}
.fgroup input,.fgroup select,.fgroup textarea{width:100%;padding:11px 14px;background:var(--surface-3);border:1.5px solid rgba(255,255,255,0.08);border-radius:var(--radius-sm);color:#E8E8E8;font-size:.9rem;font-family:'Inter',sans-serif;transition:border-color .2s,box-shadow .2s;}
.fgroup input:focus,.fgroup select:focus,.fgroup textarea:focus{outline:none;border-color:var(--saffron);box-shadow:0 0 0 3px var(--saffron-glow);}
.fgroup input::placeholder{color:var(--muted)}
.fgroup select option{background:var(--surface-2)}
.frow{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.fhint{font-size:.72rem;color:var(--muted);margin-top:5px;line-height:1.5}
.btn-primary{width:100%;padding:13px;background:var(--saffron);color:var(--ink);border:none;border-radius:var(--radius-sm);font-size:.9rem;font-weight:700;font-family:'Inter',sans-serif;cursor:pointer;letter-spacing:.2px;transition:all .15s;}
.btn-primary:hover{background:var(--saffron-light);transform:translateY(-1px)}
.btn-ghost{width:100%;padding:11px;margin-top:10px;background:transparent;border:1.5px solid rgba(255,255,255,0.1);border-radius:var(--radius-sm);color:var(--muted);font-size:.85rem;font-weight:600;font-family:'Inter',sans-serif;cursor:pointer;transition:all .15s;}
.btn-ghost:hover{border-color:rgba(255,255,255,.2);color:#E8E8E8}
.pin-input{text-align:center !important;font-size:2rem !important;letter-spacing:10px;font-weight:800 !important;color:#fff !important;}
.pin-error{color:#f87171;font-size:.8rem;margin-top:8px;display:none;text-align:center}

/* â”€â”€ Cancel code highlight â”€â”€ */
.cancel-code-box{
  background:rgba(244,161,0,0.1);border:1px solid rgba(244,161,0,0.35);
  border-radius:var(--radius-sm);padding:14px 16px;margin:16px 0;
  font-size:.88rem;line-height:1.7;
}
.cancel-code{
  display:inline-block;font-size:1.3rem;font-weight:900;
  letter-spacing:4px;color:var(--saffron);
  background:rgba(244,161,0,0.12);
  border:1px dashed rgba(244,161,0,0.4);
  border-radius:6px;padding:4px 14px;margin:6px 0;
  font-family:'Courier New',monospace;
}

/* â”€â”€ Manage list â”€â”€ */
.manage-item{display:flex;align-items:flex-start;gap:12px;padding:14px 0;border-bottom:1px solid var(--divider);}
.manage-item:last-child{border-bottom:none}
.manage-badge{width:36px;height:36px;border-radius:9px;background:var(--saffron-soft);border:1px solid rgba(244,161,0,.2);display:flex;align-items:center;justify-content:center;font-size:.9rem;flex-shrink:0;}
.manage-info{flex:1;min-width:0}
.manage-name{font-size:.9rem;font-weight:600;color:#fff}
.manage-sub{font-size:.76rem;color:var(--muted);margin-top:3px}
.btn-del{background:rgba(239,68,68,.1);border:1px solid rgba(239,68,68,.2);color:#f87171;border-radius:6px;padding:5px 10px;font-size:.72rem;font-weight:600;cursor:pointer;white-space:nowrap;font-family:'Inter',sans-serif;transition:all .15s;flex-shrink:0;}
.btn-del:hover{background:rgba(239,68,68,.2)}
.btn-cancel-booking{background:rgba(239,68,68,.08);border:1px solid rgba(239,68,68,.15);color:#f87171;border-radius:6px;padding:3px 8px;font-size:.7rem;font-weight:600;cursor:pointer;white-space:nowrap;font-family:'Inter',sans-serif;transition:all .15s;margin-left:4px;}
.btn-cancel-booking:hover{background:rgba(239,68,68,.2)}
.modal-divider{border:none;border-top:1px solid var(--divider);margin:18px 0;}

/* â”€â”€ Gym toggle chips (admin) â”€â”€ */
.gym-chip{
  display:inline-flex;align-items:center;gap:6px;
  padding:7px 14px;border-radius:50px;cursor:pointer;
  font-size:.8rem;font-weight:600;font-family:'Inter',sans-serif;
  border:1.5px solid var(--divider);background:var(--surface-3);color:var(--muted);
  transition:all .15s;
}
.gym-chip.active{background:rgba(34,197,94,0.12);border-color:rgba(34,197,94,0.35);color:#4ade80;}
.gym-chip .dot{width:8px;height:8px;border-radius:50%;background:currentColor;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GUIDE CARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.guide-card{background:var(--surface);border:1px solid var(--divider);border-radius:var(--radius-lg);padding:28px;margin-top:40px;}
.guide-card h3{font-size:1rem;font-weight:700;color:#fff;margin-bottom:18px;display:flex;align-items:center;gap:8px;}
.guide-steps{display:flex;flex-direction:column;gap:12px}
.guide-step{display:flex;gap:14px;align-items:flex-start;}
.step-num{width:26px;height:26px;border-radius:50%;flex-shrink:0;background:var(--saffron);color:var(--ink);font-size:.75rem;font-weight:800;display:flex;align-items:center;justify-content:center;margin-top:1px;}
.step-text{font-size:.88rem;color:#C0C0C0;line-height:1.6}
.step-text strong{color:#fff}
.gform-btn{display:inline-flex;align-items:center;gap:8px;margin-top:18px;background:var(--saffron);color:var(--ink);padding:11px 22px;border-radius:var(--radius-sm);font-size:.85rem;font-weight:700;text-decoration:none;transition:all .15s;}
.gform-btn:hover{background:var(--saffron-light);transform:translateY(-1px)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.toast{position:fixed;bottom:90px;left:50%;transform:translateX(-50%) translateY(12px);background:var(--surface-3);border:1px solid var(--divider);color:#E8E8E8;padding:11px 22px;border-radius:50px;font-size:.82rem;font-weight:500;box-shadow:0 8px 32px rgba(0,0,0,.5);opacity:0;transition:all .28s cubic-bezier(.34,1.56,.64,1);z-index:400;pointer-events:none;white-space:nowrap;}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FOOTER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
footer{text-align:center;padding:32px 20px;font-size:.75rem;color:var(--muted);border-top:1px solid var(--divider);margin-top:20px;}
footer a{color:var(--saffron);text-decoration:none}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESPONSIVE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media(max-width:640px){
  .slots-table th,.slots-table td{padding:8px 8px}
  .slot-btn{font-size:.72rem;padding:8px 10px;max-width:100%}
  .frow{grid-template-columns:1fr}
  .hero{padding:56px 16px 64px}
  .modal-body{padding:18px 16px}
}
</style>
</head>
<body>

<!-- â•â• HERO â•â• -->
<header class="hero">
  <div class="hero-eyebrow">ğŸ¸ Community Courts Â· Garner Rec Center</div>
  <h1>Badminton<br><span>Sign-Up</span></h1>
  <p class="hero-sub">Claim your court slot. No account needed â€” just show up and play.</p>
  <div class="hero-pills">
    <div class="pill"><span class="pill-dot"></span><span id="heroPill">Gym 3 Â· 3 Courts</span></div>
    <div class="pill"><span class="pill-dot"></span><span id="heroDateRange">Loading...</span></div>
    <div class="pill"><span class="pill-dot"></span>Volunteer-managed</div>
  </div>
</header>

<!-- â•â• STICKY TABS â•â• -->
<nav class="tabs-container">
  <div class="tabs-scroll" id="weekTabs"></div>
</nav>

<!-- â•â• PAGE BODY â•â• -->
<div class="page">

  <div class="info-banner">
    <span class="info-banner-icon">ğŸ’¡</span>
    <span>
      Tap any <strong style="color:var(--open-text)">green slot</strong> to sign up â€” no account needed.
      Each session shows which <strong>Gym</strong> and which <strong>Courts</strong> are open.
      When you sign up, you'll get a <strong>cancellation code</strong> â€” save it to free your spot if plans change.
      Schedule based on the <a href="https://garner.recdesk.com/Community/Calendar" target="_blank">Garner Rec calendar</a> and updated weekly. Always verify before heading out.
    </span>
  </div>

  <div class="legend">
    <div class="legend-item">
      <div class="legend-pip" style="background:var(--open-bg);border-color:var(--open-border)"></div>
      Available â€” click to sign up
    </div>
    <div class="legend-item">
      <div class="legend-pip" style="background:var(--taken-bg);border-color:var(--taken-border)"></div>
      Booked â€” click name to cancel
    </div>
  </div>

  <div id="weekPanels"></div>

  <!-- How It Works -->
  <div class="guide-card">
    <h3>ğŸ“‹ How sign-up works</h3>
    <div class="guide-steps">
      <div class="guide-step">
        <div class="step-num">1</div>
        <div class="step-text">Choose your week using the tabs above, then find your preferred day and time slot.</div>
      </div>
      <div class="guide-step">
        <div class="step-num">2</div>
        <div class="step-text">Click any <strong>green "Available" button</strong> under a court. A Google Form opens in a new tab â€” no Google account required.</div>
      </div>
      <div class="guide-step">
        <div class="step-num">3</div>
        <div class="step-text">Fill in your name and submit. Your court is reserved! You'll see a <strong style="color:var(--saffron)">cancellation code</strong> â€” save it.</div>
      </div>
      <div class="guide-step">
        <div class="step-num">4</div>
        <div class="step-text">Can't make it? Click your name on the court slot and enter your code to <strong>instantly free the spot</strong> for someone else â€” no coordinator needed.</div>
      </div>
    </div>
    <a class="gform-btn" href="https://forms.gle/o7Xb2rM8kLk4CEaf7" target="_blank">
      ğŸ“ Open sign-up form â†’
    </a>
  </div>

</div>

<!-- â•â• ADMIN FAB â•â• -->
<button class="fab" id="adminFab" onclick="openPinModal()">
  <span class="fab-icon">âš™ï¸</span>
  <span>Coordinator</span>
</button>

<!-- â•â• PIN MODAL â•â• -->
<div class="overlay" id="pinOverlay">
  <div class="modal modal-sm">
    <div class="modal-head">
      <h2>Coordinator Access</h2>
      <button class="modal-close" onclick="closeOverlay('pinOverlay')">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="fgroup">
        <label>Enter PIN</label>
        <input type="password" class="pin-input" id="pinInput" maxlength="6" placeholder="â€¢â€¢â€¢â€¢"
               onkeydown="if(event.key==='Enter')checkPin()"/>
        <div class="pin-error" id="pinError">Incorrect PIN â€” try again.</div>
      </div>
      <button class="btn-primary" onclick="checkPin()">Unlock</button>
    </div>
  </div>
</div>

<!-- â•â• SIGN-UP MODAL (name entry) â•â• -->
<div class="overlay" id="signupOverlay">
  <div class="modal modal-sm">
    <div class="modal-head">
      <h2>Reserve Your Court</h2>
      <button class="modal-close" onclick="closeOverlay('signupOverlay')">âœ•</button>
    </div>
    <div class="modal-body">
      <div id="signupSlotInfo" style="font-size:.82rem;color:var(--muted);margin-bottom:16px;line-height:1.7;"></div>
      <div class="fgroup">
        <label>Your Name</label>
        <input type="text" id="signupName" placeholder="e.g. Priya Sharma"
               onkeydown="if(event.key==='Enter')confirmSignup()"/>
        <p class="fhint">Enter the name you'll use when you arrive at the gym.</p>
      </div>
      <button class="btn-primary" onclick="confirmSignup()">Reserve Court</button>
      <button class="btn-ghost" onclick="closeOverlay('signupOverlay')">Cancel</button>
    </div>
  </div>
</div>

<!-- â•â• BOOKING CONFIRMED MODAL â•â• -->
<div class="overlay" id="confirmedOverlay">
  <div class="modal modal-sm">
    <div class="modal-head">
      <h2>âœ… Court Reserved!</h2>
      <button class="modal-close" onclick="closeOverlay('confirmedOverlay')">âœ•</button>
    </div>
    <div class="modal-body">
      <div id="confirmedDetails" style="font-size:.85rem;color:#C8C8C8;line-height:1.7;margin-bottom:4px;"></div>
      <div class="cancel-code-box">
        <div style="font-size:.75rem;font-weight:700;color:var(--saffron);letter-spacing:.5px;text-transform:uppercase;margin-bottom:6px;">ğŸ”‘ Your Cancellation Code</div>
        <div id="confirmedCode" class="cancel-code"></div>
        <div style="font-size:.76rem;color:var(--muted-2);margin-top:8px;line-height:1.6;">
          Save this code! If your plans change, click your name on the court slot and enter this code to instantly free the spot â€” no coordinator needed.
        </div>
      </div>
      <button class="btn-primary" onclick="closeOverlay('confirmedOverlay')">Got it â€” see you on the court! ğŸ¸</button>
    </div>
  </div>
</div>

<!-- â•â• CANCEL BOOKING MODAL â•â• -->
<div class="overlay" id="cancelOverlay">
  <div class="modal modal-sm">
    <div class="modal-head">
      <h2>Cancel Reservation</h2>
      <button class="modal-close" onclick="closeOverlay('cancelOverlay')">âœ•</button>
    </div>
    <div class="modal-body">
      <div id="cancelSlotInfo" style="font-size:.82rem;color:var(--muted);margin-bottom:16px;line-height:1.7;"></div>
      <div class="fgroup">
        <label>Enter Your Cancellation Code</label>
        <input type="text" id="cancelCodeInput" placeholder="e.g. AB1C2D"
               style="text-transform:uppercase;letter-spacing:2px;font-weight:700;"
               onkeydown="if(event.key==='Enter')confirmCancel()"/>
        <p class="fhint">This was shown to you when you signed up.</p>
      </div>
      <div class="pin-error" id="cancelError">Incorrect code â€” check your code and try again.</div>
      <button class="btn-primary" onclick="confirmCancel()" style="margin-top:8px;">Free This Slot</button>
      <button class="btn-ghost" onclick="closeOverlay('cancelOverlay')">Go Back</button>
      <p style="font-size:.72rem;color:var(--muted);margin-top:14px;text-align:center;">
        Lost your code? Contact the coordinator to manually free the slot.
      </p>
    </div>
  </div>
</div>

<!-- â•â• ADD SLOT MODAL â•â• -->
<div class="overlay" id="addOverlay">
  <div class="modal">
    <div class="modal-head">
      <h2>Add Badminton Slot</h2>
      <button class="modal-close" onclick="closeOverlay('addOverlay')">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="fgroup">
        <label>Date</label>
        <input type="date" id="slotDate"/>
      </div>
      <div class="frow">
        <div class="fgroup">
          <label>Start Time</label>
          <input type="time" id="slotStart" value="06:00"/>
        </div>
        <div class="fgroup">
          <label>End Time</label>
          <input type="time" id="slotEnd" value="09:30"/>
        </div>
      </div>
      <div class="frow">
        <div class="fgroup">
          <label>Gym</label>
          <select id="slotGym"></select>
          <p class="fhint">Only enabled gyms are available for booking.</p>
        </div>
        <div class="fgroup">
          <label>Number of Courts</label>
          <select id="slotCourts">
            <option value="3" selected>3 Courts</option>
            <option value="2">2 Courts</option>
            <option value="1">1 Court</option>
          </select>
          <p class="fhint">How many courts are open this session.</p>
        </div>
      </div>
      <div class="fgroup">
        <label>Session Notes (optional)</label>
        <input type="text" id="slotNotes" placeholder="e.g. Evening Open Play"/>
      </div>
      <div class="fgroup">
        <label>Google Form URL</label>
        <input type="url" id="slotFormUrl" placeholder="https://forms.gle/..."/>
        <p class="fhint">Leave blank to use the default form. Sign-up button opens this form in a new tab.</p>
      </div>
      <button class="btn-primary" onclick="addSlot()">Add Slot</button>
      <button class="btn-ghost" onclick="closeOverlay('addOverlay')">Cancel</button>
    </div>
  </div>
</div>

<!-- â•â• BULK ADD MODAL â•â• -->
<div class="overlay" id="bulkOverlay">
  <div class="modal">
    <div class="modal-head">
      <h2>ğŸ“… Add Recurring Slots</h2>
      <button class="modal-close" onclick="closeOverlay('bulkOverlay')">âœ•</button>
    </div>
    <div class="modal-body">
      <p style="font-size:.82rem;color:var(--muted);margin-bottom:18px;line-height:1.6;">
        Add multiple weeks at once â€” e.g. every Tuesday &amp; Friday for the next 4 weeks.
      </p>
      <div class="fgroup">
        <label>Which days of the week?</label>
        <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:2px;">
          <label style="display:flex;align-items:center;gap:5px;font-size:.85rem;color:#E8E8E8;text-transform:none;letter-spacing:0;cursor:pointer;background:var(--surface-3);border:1px solid var(--divider);border-radius:6px;padding:6px 12px;">
            <input type="checkbox" name="bulkDay" value="1" style="width:auto;accent-color:var(--saffron);"> Mon
          </label>
          <label style="display:flex;align-items:center;gap:5px;font-size:.85rem;color:#E8E8E8;text-transform:none;letter-spacing:0;cursor:pointer;background:var(--surface-3);border:1px solid var(--divider);border-radius:6px;padding:6px 12px;">
            <input type="checkbox" name="bulkDay" value="2" checked style="width:auto;accent-color:var(--saffron);"> Tue
          </label>
          <label style="display:flex;align-items:center;gap:5px;font-size:.85rem;color:#E8E8E8;text-transform:none;letter-spacing:0;cursor:pointer;background:var(--surface-3);border:1px solid var(--divider);border-radius:6px;padding:6px 12px;">
            <input type="checkbox" name="bulkDay" value="3" checked style="width:auto;accent-color:var(--saffron);"> Wed
          </label>
          <label style="display:flex;align-items:center;gap:5px;font-size:.85rem;color:#E8E8E8;text-transform:none;letter-spacing:0;cursor:pointer;background:var(--surface-3);border:1px solid var(--divider);border-radius:6px;padding:6px 12px;">
            <input type="checkbox" name="bulkDay" value="4" style="width:auto;accent-color:var(--saffron);"> Thu
          </label>
          <label style="display:flex;align-items:center;gap:5px;font-size:.85rem;color:#E8E8E8;text-transform:none;letter-spacing:0;cursor:pointer;background:var(--surface-3);border:1px solid var(--divider);border-radius:6px;padding:6px 12px;">
            <input type="checkbox" name="bulkDay" value="5" checked style="width:auto;accent-color:var(--saffron);"> Fri
          </label>
          <label style="display:flex;align-items:center;gap:5px;font-size:.85rem;color:#E8E8E8;text-transform:none;letter-spacing:0;cursor:pointer;background:var(--surface-3);border:1px solid var(--divider);border-radius:6px;padding:6px 12px;">
            <input type="checkbox" name="bulkDay" value="6" checked style="width:auto;accent-color:var(--saffron);"> Sat
          </label>
          <label style="display:flex;align-items:center;gap:5px;font-size:.85rem;color:#E8E8E8;text-transform:none;letter-spacing:0;cursor:pointer;background:var(--surface-3);border:1px solid var(--divider);border-radius:6px;padding:6px 12px;">
            <input type="checkbox" name="bulkDay" value="0" style="width:auto;accent-color:var(--saffron);"> Sun
          </label>
        </div>
      </div>
      <div class="frow">
        <div class="fgroup"><label>From Date</label><input type="date" id="bulkFrom"/></div>
        <div class="fgroup"><label>To Date</label><input type="date" id="bulkTo"/></div>
      </div>
      <div class="frow">
        <div class="fgroup"><label>Start Time</label><input type="time" id="bulkStart" value="06:00"/></div>
        <div class="fgroup"><label>End Time</label><input type="time" id="bulkEnd" value="09:30"/></div>
      </div>
      <div class="frow">
        <div class="fgroup">
          <label>Gym</label>
          <select id="bulkGym"></select>
        </div>
        <div class="fgroup">
          <label>Number of Courts</label>
          <select id="bulkCourts">
            <option value="3" selected>3 Courts</option>
            <option value="2">2 Courts</option>
            <option value="1">1 Court</option>
          </select>
        </div>
      </div>
      <div class="fgroup">
        <label>Session Notes (optional)</label>
        <input type="text" id="bulkNotes" placeholder="e.g. Morning Open Play"/>
      </div>
      <div id="bulkPreview" style="display:none;margin-bottom:18px;">
        <div style="font-size:.75rem;font-weight:700;color:var(--saffron);letter-spacing:.4px;text-transform:uppercase;margin-bottom:8px;">Preview â€” slots to be created</div>
        <div id="bulkPreviewList" style="background:var(--surface-3);border-radius:8px;padding:12px;font-size:.8rem;color:var(--muted);max-height:140px;overflow-y:auto;line-height:1.9;"></div>
      </div>
      <button class="btn-primary" style="margin-bottom:10px;" onclick="previewBulk()">Preview Slots</button>
      <button class="btn-primary" id="bulkConfirmBtn" style="display:none;background:#1e8e3e;" onclick="confirmBulk()">âœ… Add All Slots</button>
      <button class="btn-ghost" onclick="closeOverlay('bulkOverlay')">Cancel</button>
    </div>
  </div>
</div>

<!-- â•â• MANAGE MODAL â•â• -->
<div class="overlay" id="manageOverlay">
  <div class="modal">
    <div class="modal-head">
      <h2>Manage Slots</h2>
      <button class="modal-close" onclick="closeOverlay('manageOverlay')">âœ•</button>
    </div>
    <div class="modal-body">
      <!-- Gym enable/disable toggles -->
      <div style="margin-bottom:18px;">
        <div style="font-size:.72rem;font-weight:700;color:var(--saffron);letter-spacing:.5px;text-transform:uppercase;margin-bottom:10px;">Gym Status</div>
        <div id="gymChips" style="display:flex;gap:8px;flex-wrap:wrap;"></div>
        <p class="fhint" style="margin-top:8px;">Toggle gyms on/off. Only enabled gyms appear in the booking form and scheduling modals.</p>
      </div>
      <hr class="modal-divider"/>
      <div style="display:flex;gap:10px;margin-bottom:16px;flex-wrap:wrap;">
        <button class="btn-primary" style="flex:1;min-width:140px;" onclick="closeOverlay('manageOverlay');openAddModal('')">ï¼‹ Single Slot</button>
        <button class="btn-primary" style="flex:1;min-width:140px;background:#6b3fa0;" onclick="closeOverlay('manageOverlay');openBulkModal()">ğŸ“… Recurring Slots</button>
      </div>
      <hr class="modal-divider"/>
      <div id="manageList"></div>
    </div>
  </div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<footer>
  <p>Community badminton coordination for Garner Rec Center Â· Volunteer-managed Â· Not an official service</p>
  <p style="margin-top:4px">
    <a href="https://garner.recdesk.com/Community/Calendar" target="_blank">Official Garner Rec Calendar â†—</a>
  </p>
  <p style="margin-top:12px;color:#555;font-size:.72rem;">
    Built with â¤ï¸ by <strong style="color:#888">Viral Patel</strong> for the Garner badminton community
  </p>
</footer>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     JAVASCRIPT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONFIG
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const ADMIN_PIN    = "8164";
const DEFAULT_FORM = "https://forms.gle/o7Xb2rM8kLk4CEaf7";

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GYM CONFIG â€” future-proof
   Add new gyms here; set enabled:true when the gym opens.
   courts = max courts that gym has (used in add-slot UI limit).
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const GYM_DEFAULTS = [
  { name:"Gym 3", courts:3, enabled:true  },
  { name:"Gym 1", courts:3, enabled:false },
  { name:"Gym 2", courts:3, enabled:false },
];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE â€” persisted in localStorage
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const LS      = "garner_badminton_v4";
const LS_GYMS = "garner_badminton_gyms_v1";

let slots = (() => {
  // Migrate from old v3 key if present
  try {
    const old = localStorage.getItem("garner_badminton_v3");
    if(old && !localStorage.getItem(LS)){
      localStorage.setItem(LS, old);
    }
  } catch(e){}
  try { const d=localStorage.getItem(LS); return d?JSON.parse(d):[]; } catch(e){ return []; }
})();

let gyms = (() => {
  try {
    const d = localStorage.getItem(LS_GYMS);
    if(d){
      // Merge saved gym states with defaults (allows new gyms added to GYM_DEFAULTS to appear)
      const saved = JSON.parse(d);
      return GYM_DEFAULTS.map(def => {
        const found = saved.find(g => g.name === def.name);
        return found ? {...def, ...found} : {...def};
      });
    }
    return GYM_DEFAULTS.map(g => ({...g}));
  } catch(e){ return GYM_DEFAULTS.map(g => ({...g})); }
})();

let adminUnlocked    = false;
let activeWeek       = 0;
let bulkPreviewSlots = [];

// Transient sign-up state (not persisted)
let pendingSignup = null; // {slotId, ci}
let pendingCancel = null; // {slotId, ci}

function save(){
  localStorage.setItem(LS, JSON.stringify(slots));
  localStorage.setItem(LS_GYMS, JSON.stringify(gyms));
}
function genId(){ return 's'+Date.now()+Math.random().toString(36).slice(2,5); }

/* â”€â”€ Cancellation code generator â€” 6 chars alphanumeric, easy to read/type â”€â”€ */
function genCancelCode(){
  const chars='ABCDEFGHJKLMNPQRSTUVWXYZ23456789'; // removed 0/O/1/I to avoid confusion
  let code='';
  for(let i=0;i<6;i++) code+=chars[Math.floor(Math.random()*chars.length)];
  return code;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const f12 = t => {
  const [h,m]=t.split(':').map(Number);
  return `${h%12||12}:${String(m).padStart(2,'0')} ${h<12?'AM':'PM'}`;
};
function fmtDay(ds){ return new Date(ds+'T00:00:00').toLocaleDateString('en-US',{weekday:'long'}); }
function fmtFull(ds){ return new Date(ds+'T00:00:00').toLocaleDateString('en-US',{month:'long',day:'numeric',year:'numeric'}); }
function fmtShort(ds){ return new Date(ds+'T00:00:00').toLocaleDateString('en-US',{month:'short',day:'numeric'}); }
function fmtWeek(mon){
  const sun=new Date(mon); sun.setDate(mon.getDate()+6);
  return `${fmtShort(mon.toISOString().slice(0,10))} â€“ ${fmtShort(sun.toISOString().slice(0,10))}`;
}
function dayEmoji(ds){
  return ['ğŸŒ','ğŸŒ™','â­','ğŸ”¥','ğŸ’«','ğŸŒ…','ğŸ…'][new Date(ds+'T00:00:00').getDay()];
}
function escHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
function isoDate(d){ return d.toISOString().slice(0,10); }

function enabledGyms(){ return gyms.filter(g=>g.enabled); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WEEK GROUPING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function getWeeks(){
  const today = isoDate(new Date());
  const map   = {};
  slots
    .filter(s => s.date >= today)
    .forEach(s => {
      const d   = new Date(s.date+'T00:00:00');
      const dow = d.getDay();
      const mon = new Date(d); mon.setDate(d.getDate()+(dow===0?-6:1-dow));
      const key = isoDate(mon);
      if(!map[key]) map[key]={monday:mon, slots:[]};
      map[key].slots.push(s);
    });
  return Object.entries(map).sort((a,b)=>a[0].localeCompare(b[0])).map(([,v])=>v);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HERO PILL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function updateHeroPill(){
  const enabled = enabledGyms();
  const gymNames = enabled.map(g=>g.name).join(' & ');
  const totalCourts = enabled.reduce((s,g)=>s+g.courts,0);
  const pillEl = document.getElementById('heroPill');
  if(pillEl) pillEl.textContent = enabled.length
    ? `${gymNames} Â· ${totalCourts} Court${totalCourts!==1?'s':''}`
    : 'No gyms open yet';

  const weeks = getWeeks();
  const el = document.getElementById('heroDateRange');
  if(!el) return;
  if(!weeks.length){ el.textContent='No upcoming slots'; return; }
  const allDates = weeks.flatMap(w=>w.slots.map(s=>s.date)).sort();
  const first = allDates[0], last = allDates[allDates.length-1];
  const y1 = new Date(first+'T00:00:00').getFullYear();
  const y2 = new Date(last+'T00:00:00').getFullYear();
  el.textContent = y1===y2
    ? new Date(first+'T00:00:00').toLocaleDateString('en-US',{month:'short'})+' â€“ '+new Date(last+'T00:00:00').toLocaleDateString('en-US',{month:'short',year:'numeric'})
    : `${y1} â€“ ${y2}`;
}

function findCurrentWeekIndex(weeks){
  const today = isoDate(new Date());
  for(let i=0;i<weeks.length;i++){
    const max = weeks[i].slots.map(s=>s.date).reduce((a,b)=>a>b?a:b,'');
    if(max>=today) return i;
  }
  return 0;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GYM DROPDOWN POPULATE (add/bulk modals)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function populateGymDropdown(selectId){
  const el = document.getElementById(selectId);
  if(!el) return;
  const enabled = enabledGyms();
  el.innerHTML = enabled.length
    ? enabled.map(g=>`<option value="${escHtml(g.name)}">${escHtml(g.name)}</option>`).join('')
    : `<option value="">No gyms enabled</option>`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RENDER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function render(){
  const weeks    = getWeeks();
  const tabsEl   = document.getElementById('weekTabs');
  const panelsEl = document.getElementById('weekPanels');
  tabsEl.innerHTML   = '';
  panelsEl.innerHTML = '';
  document.body.classList.toggle('admin-unlocked', adminUnlocked);
  updateHeroPill();

  if(!weeks.length){
    panelsEl.innerHTML=`<div class="empty-week">
      <div class="empty-icon">ğŸ“…</div>
      <h3>No upcoming slots</h3>
      <p>The coordinator hasn't added sessions yet â€” check back soon!<br>
      <span style="color:var(--muted-2);font-size:.8rem;">Coordinators: use the <strong style="color:#E8E8E8">âš™ï¸ Coordinator</strong> button to add slots.</span></p>
    </div>`;
    return;
  }

  if(activeWeek >= weeks.length) activeWeek = findCurrentWeekIndex(weeks);

  weeks.forEach((wk,wi)=>{
    const isActive  = wi===activeWeek;
    const isCurrent = wi===findCurrentWeekIndex(weeks);

    const tab = document.createElement('button');
    tab.className = 'tab-btn'+(isActive?' active':'');
    tab.innerHTML = isActive
      ? `${isCurrent?'<span style="font-size:.65rem;margin-right:4px;opacity:.8">THIS WEEK</span>':''}${fmtWeek(wk.monday)}`
      : (isCurrent ? `<span style="font-size:.65rem;display:block;opacity:.7">THIS WEEK</span>${fmtWeek(wk.monday)}` : fmtWeek(wk.monday));
    tab.onclick = ()=>{ activeWeek=wi; render(); };
    tabsEl.appendChild(tab);

    const panel = document.createElement('div');
    panel.className = 'week-panel'+(isActive?' active':'');

    const monthYear = wk.monday.toLocaleDateString('en-US',{month:'long',year:'numeric'});
    panel.innerHTML = `
      <div class="week-header">
        <div>
          <div class="week-header-title">${monthYear} &nbsp;Â·&nbsp; ${fmtWeek(wk.monday)}</div>
          <div class="week-header-sub">Garner Rec Center Â· Each session shows the gym and available courts</div>
        </div>
        <button class="btn-add-slot" onclick="openAddModal('')">ï¼‹ Add Single Slot</button>
      </div>`;

    [...wk.slots].sort((a,b)=>a.date.localeCompare(b.date)).forEach(slot=>{
      const isPast = slot.date < isoDate(new Date());
      const sec = document.createElement('div');
      sec.className = 'day-section';

      const courtCols = slot.courts.map((c,ci)=>{
        if(c.takenBy){
          return `<td>
            <button class="slot-btn slot-taken" onclick="openCancelModal('${slot.id}',${ci})"
              title="Click to cancel this booking">
              ğŸ‘¤ ${escHtml(c.takenBy)}
            </button>
            <button class="btn-cancel-slot" onclick="openCancelModal('${slot.id}',${ci})">cancel reservation</button>
          </td>`;
        } else if(isPast){
          return `<td><button class="slot-btn slot-taken" disabled style="font-style:normal;cursor:default;">â€”</button></td>`;
        } else {
          return `<td><button class="slot-btn slot-open" onclick="openSignupModal('${slot.id}',${ci})">Available</button></td>`;
        }
      }).join('');

      sec.innerHTML = `
        <div class="day-card" style="${isPast?'opacity:.45;':''}">
          <div class="day-head">
            <div class="day-head-left">
              <div class="day-dot">${dayEmoji(slot.date)}</div>
              <div>
                <div class="day-name">${fmtDay(slot.date)}, ${fmtFull(slot.date)}${isPast?' <span style="font-size:.7rem;color:var(--muted);font-weight:400;">(past)</span>':''}</div>
                <div class="day-date-str">${escHtml(slot.gym||'Gym 3')}${slot.notes?' Â· '+escHtml(slot.notes):''}</div>
              </div>
            </div>
            <div class="day-time-badge">â° ${slot.start} â€“ ${slot.end}</div>
          </div>
          <table class="slots-table">
            <thead>
              <tr>
                <th>Time</th>
                ${slot.courts.map(c=>`<th>ğŸ¸ ${escHtml(c.name)}</th>`).join('')}
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>${slot.start}<br><span style="color:var(--muted);font-weight:400;font-size:.73rem;">to ${slot.end}</span></td>
                ${courtCols}
              </tr>
            </tbody>
          </table>
        </div>`;
      panel.appendChild(sec);
    });

    panelsEl.appendChild(panel);
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SIGN-UP FLOW (with cancellation code)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openSignupModal(slotId, ci){
  const slot = slots.find(s=>s.id===slotId);
  if(!slot){ showToast("Slot not found."); return; }

  // Double-booking guard â€” re-check at open time
  if(slot.courts[ci].takenBy){
    showToast("âš¡ That court was just taken! Choose another.");
    render(); return;
  }

  pendingSignup = {slotId, ci};
  document.getElementById('signupName').value = '';
  document.getElementById('signupSlotInfo').innerHTML =
    `ğŸ“… <strong>${fmtDay(slot.date)}, ${fmtFull(slot.date)}</strong><br>
     â° ${slot.start} â€“ ${slot.end}<br>
     ğŸŸï¸ ${escHtml(slot.gym||'Gym 3')} Â· <strong>${escHtml(slot.courts[ci].name)}</strong>`;
  openOverlay('signupOverlay');
  setTimeout(()=>document.getElementById('signupName').focus(),160);
}

function confirmSignup(){
  if(!pendingSignup){ closeOverlay('signupOverlay'); return; }
  const {slotId, ci} = pendingSignup;
  const name = document.getElementById('signupName').value.trim();
  if(!name){ showToast("âš ï¸ Please enter your name."); return; }

  const slot = slots.find(s=>s.id===slotId);
  if(!slot){ showToast("Slot not found."); closeOverlay('signupOverlay'); return; }

  // Double-booking guard â€” re-check at confirm time (race condition protection)
  if(slot.courts[ci].takenBy){
    showToast("âš¡ Sorry, someone just took that court! Please choose another.");
    closeOverlay('signupOverlay');
    pendingSignup = null;
    render(); return;
  }

  // Open Google Form in background tab (optional, non-blocking)
  const formUrl = slot.formUrl && slot.formUrl !== DEFAULT_FORM && !slot.formUrl.includes('YOUR_GOOGLE')
    ? slot.formUrl : DEFAULT_FORM;
  if(formUrl && formUrl.includes('http')){
    const info = `${fmtFull(slot.date)} | ${slot.start}â€“${slot.end} | ${slot.gym||'Gym 3'} | ${slot.courts[ci].name} | ${name}`;
    window.open(formUrl+'#info='+encodeURIComponent(info), '_blank');
  }

  // Generate unique cancellation code and save booking
  const code = genCancelCode();
  slot.courts[ci].takenBy   = name;
  slot.courts[ci].cancelCode = code;
  save(); render();
  closeOverlay('signupOverlay');
  pendingSignup = null;

  // Show confirmation with code
  document.getElementById('confirmedDetails').innerHTML =
    `âœ… <strong>${escHtml(name)}</strong> is reserved for:<br>
     ğŸ“… ${fmtDay(slot.date)}, ${fmtFull(slot.date)}<br>
     â° ${slot.start} â€“ ${slot.end}<br>
     ğŸŸï¸ ${escHtml(slot.gym||'Gym 3')} Â· <strong>${escHtml(slot.courts[ci].name)}</strong>`;
  document.getElementById('confirmedCode').textContent = code;
  openOverlay('confirmedOverlay');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CANCELLATION FLOW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openCancelModal(slotId, ci){
  const slot = slots.find(s=>s.id===slotId);
  if(!slot||!slot.courts[ci].takenBy){ showToast("This slot is already free."); return; }

  pendingCancel = {slotId, ci};
  document.getElementById('cancelCodeInput').value = '';
  document.getElementById('cancelError').style.display = 'none';
  document.getElementById('cancelSlotInfo').innerHTML =
    `ğŸ“… <strong>${fmtDay(slot.date)}, ${fmtFull(slot.date)}</strong><br>
     â° ${slot.start} â€“ ${slot.end}<br>
     ğŸŸï¸ ${escHtml(slot.gym||'Gym 3')} Â· <strong>${escHtml(slot.courts[ci].name)}</strong><br>
     ğŸ‘¤ Reserved by: <strong>${escHtml(slot.courts[ci].takenBy)}</strong>`;
  openOverlay('cancelOverlay');
  setTimeout(()=>document.getElementById('cancelCodeInput').focus(),160);
}

function confirmCancel(){
  if(!pendingCancel){ closeOverlay('cancelOverlay'); return; }
  const {slotId, ci} = pendingCancel;
  const entered = document.getElementById('cancelCodeInput').value.trim().toUpperCase();
  if(!entered){ showToast("âš ï¸ Enter your cancellation code."); return; }

  const slot = slots.find(s=>s.id===slotId);
  if(!slot){ showToast("Slot not found."); closeOverlay('cancelOverlay'); return; }

  const court = slot.courts[ci];
  const storedCode = (court.cancelCode||'').toUpperCase();

  if(!storedCode || entered !== storedCode){
    document.getElementById('cancelError').style.display = 'block';
    document.getElementById('cancelCodeInput').value = '';
    document.getElementById('cancelCodeInput').focus();
    return;
  }

  // Code matches â€” free the slot
  const who = court.takenBy;
  court.takenBy    = '';
  court.cancelCode = '';
  save(); render();
  closeOverlay('cancelOverlay');
  pendingCancel = null;
  showToast(`âœ… Reservation for ${who} cancelled. Slot is now open!`, 3500);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ADMIN: PIN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openPinModal(){
  if(adminUnlocked){ openManage(); return; }
  openOverlay('pinOverlay');
  setTimeout(()=>document.getElementById('pinInput').focus(),150);
}
function checkPin(){
  if(document.getElementById('pinInput').value===ADMIN_PIN){
    adminUnlocked=true;
    closeOverlay('pinOverlay');
    document.getElementById('pinInput').value='';
    document.getElementById('pinError').style.display='none';
    render(); showToast("ğŸ”“ Admin mode active"); openManage();
  } else {
    document.getElementById('pinError').style.display='block';
    document.getElementById('pinInput').value='';
    document.getElementById('pinInput').focus();
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ADMIN: SINGLE SLOT ADD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openAddModal(defaultDate){
  if(!adminUnlocked){ openPinModal(); return; }
  if(!defaultDate){
    const t=new Date(); t.setDate(t.getDate()+1);
    defaultDate=isoDate(t);
  }
  populateGymDropdown('slotGym');
  document.getElementById('slotDate').value=defaultDate;
  document.getElementById('slotFormUrl').value=DEFAULT_FORM.includes('YOUR_GOOGLE')?'':DEFAULT_FORM;
  openOverlay('addOverlay');
}

function addSlot(){
  const date  = document.getElementById('slotDate').value;
  const start = document.getElementById('slotStart').value;
  const end   = document.getElementById('slotEnd').value;
  const notes = document.getElementById('slotNotes').value.trim();
  const fu    = document.getElementById('slotFormUrl').value.trim()||DEFAULT_FORM;

  if(!date||!start||!end){ showToast("âš ï¸ Date, start and end time are required."); return; }
  if(start>=end){ showToast("âš ï¸ End time must be after start time."); return; }

  const gym       = document.getElementById('slotGym').value;
  const numCourts = parseInt(document.getElementById('slotCourts').value);
  const courts    = Array.from({length:numCourts},(_,i)=>({name:`Court ${i+1}`,takenBy:'',cancelCode:''}));

  slots.push({id:genId(),date,start:f12(start),end:f12(end),gym,notes:notes||'',formUrl:fu,courts});
  save(); closeOverlay('addOverlay'); render();
  showToast(`âœ… Slot added â€” ${gym} Â· ${numCourts} court(s)!`);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ADMIN: BULK RECURRING ADD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openBulkModal(){
  if(!adminUnlocked){ openPinModal(); return; }
  const from=new Date(); from.setDate(from.getDate()+1);
  const to=new Date(); to.setDate(to.getDate()+28);
  document.getElementById('bulkFrom').value=isoDate(from);
  document.getElementById('bulkTo').value=isoDate(to);
  document.getElementById('bulkPreview').style.display='none';
  document.getElementById('bulkConfirmBtn').style.display='none';
  populateGymDropdown('bulkGym');
  bulkPreviewSlots=[];
  openOverlay('bulkOverlay');
}

function previewBulk(){
  const fromStr = document.getElementById('bulkFrom').value;
  const toStr   = document.getElementById('bulkTo').value;
  const start   = document.getElementById('bulkStart').value;
  const end     = document.getElementById('bulkEnd').value;
  const notes   = document.getElementById('bulkNotes').value.trim();

  if(!fromStr||!toStr||!start||!end){ showToast("âš ï¸ Fill in all date and time fields."); return; }
  if(start>=end){ showToast("âš ï¸ End time must be after start time."); return; }

  const selectedDays=[...document.querySelectorAll('input[name="bulkDay"]:checked')].map(el=>parseInt(el.value));
  if(!selectedDays.length){ showToast("âš ï¸ Select at least one day of the week."); return; }

  const gym       = document.getElementById('bulkGym').value;
  const numCourts = parseInt(document.getElementById('bulkCourts').value);

  const cur=new Date(fromStr+'T00:00:00');
  const endDate=new Date(toStr+'T00:00:00');
  bulkPreviewSlots=[];

  const existingKeys=new Set(slots.map(s=>s.date+f12(s.start||'')+s.gym));

  while(cur<=endDate){
    if(selectedDays.includes(cur.getDay())){
      const ds=isoDate(cur);
      const key=ds+f12(start)+gym;
      if(!existingKeys.has(key)){
        const courts=Array.from({length:numCourts},(_,i)=>({name:`Court ${i+1}`,takenBy:'',cancelCode:''}));
        bulkPreviewSlots.push({
          id:genId(), date:ds,
          start:f12(start), end:f12(end),
          gym, notes:notes||'',
          formUrl:DEFAULT_FORM,
          courts
        });
      }
    }
    cur.setDate(cur.getDate()+1);
  }

  if(!bulkPreviewSlots.length){
    showToast("âš ï¸ No new slots to add (all dates may already exist).");
    return;
  }

  const DAY_NAMES=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
  const list=document.getElementById('bulkPreviewList');
  list.innerHTML=bulkPreviewSlots.map(s=>`
    <span style="color:#E8E8E8;font-weight:600;">${DAY_NAMES[new Date(s.date+'T00:00:00').getDay()]} ${fmtShort(s.date)}</span>
    <span style="color:var(--muted);"> Â· ${s.gym} Â· ${s.start}â€“${s.end} Â· ${s.courts.length} court(s)</span><br>`
  ).join('');
  document.getElementById('bulkPreview').style.display='block';
  document.getElementById('bulkConfirmBtn').style.display='block';
  document.getElementById('bulkConfirmBtn').textContent=`âœ… Add All ${bulkPreviewSlots.length} Slots`;
}

function confirmBulk(){
  if(!bulkPreviewSlots.length) return;
  slots.push(...bulkPreviewSlots);
  save(); closeOverlay('bulkOverlay'); render();
  showToast(`âœ… ${bulkPreviewSlots.length} slots added!`);
  bulkPreviewSlots=[];
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ADMIN: GYM TOGGLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function toggleGym(gymName){
  const g = gyms.find(x=>x.name===gymName);
  if(!g) return;
  g.enabled = !g.enabled;
  save(); renderGymChips(); updateHeroPill();
  showToast(`${gymName} is now ${g.enabled?'âœ… enabled':'â›” disabled'}.`);
}

function renderGymChips(){
  const el = document.getElementById('gymChips');
  if(!el) return;
  el.innerHTML = gyms.map(g=>`
    <button class="gym-chip ${g.enabled?'active':''}" onclick="toggleGym('${escHtml(g.name)}')">
      <span class="dot"></span>
      ${escHtml(g.name)} â€” ${g.enabled?'Open':'Closed'}
    </button>`).join('');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ADMIN: MANAGE MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openManage(){
  renderGymChips();
  const el=document.getElementById('manageList');
  const sorted=[...slots].sort((a,b)=>a.date.localeCompare(b.date));

  if(!sorted.length){
    el.innerHTML=`<p style="color:var(--muted);font-size:.88rem;">No slots added yet.</p>`;
  } else {
    el.innerHTML=sorted.map(s=>`
      <div class="manage-item">
        <div class="manage-badge">${dayEmoji(s.date)}</div>
        <div class="manage-info">
          <div class="manage-name">${fmtDay(s.date)}, ${fmtFull(s.date)}</div>
          <div class="manage-sub">${escHtml(s.gym||'Gym 3')} Â· ${s.start} â€“ ${s.end}${s.notes?' Â· '+escHtml(s.notes):''}</div>
          <div class="manage-sub" style="margin-top:4px;">
            ${s.courts.map(c=>
              c.takenBy
                ? `${escHtml(c.name)}: <strong style="color:#E8E8E8">${escHtml(c.takenBy)}</strong>
                   <button class="btn-cancel-booking" onclick="adminCancelBooking('${s.id}','${escHtml(c.name)}')">âœ• free</button>`
                : `${escHtml(c.name)}: <span style="color:var(--open-text)">open</span>`
            ).join(' &nbsp;Â·&nbsp; ')}
          </div>
        </div>
        <button class="btn-del" onclick="deleteSlot('${s.id}')">Delete</button>
      </div>`).join('');
  }
  openOverlay('manageOverlay');
}

/* Admin can force-cancel any booking without a code */
function adminCancelBooking(slotId, courtName){
  const slot = slots.find(s=>s.id===slotId);
  if(!slot) return;
  const court = slot.courts.find(c=>c.name===courtName);
  if(!court||!court.takenBy) return;
  if(!confirm(`Cancel ${court.takenBy}'s booking for ${courtName}?`)) return;
  const who = court.takenBy;
  court.takenBy=''; court.cancelCode='';
  save(); openManage(); render();
  showToast(`âœ… ${who}'s booking cancelled.`);
}

function deleteSlot(id){
  if(!confirm("Delete this slot and all its bookings?")) return;
  slots=slots.filter(s=>s.id!==id);
  save(); openManage(); render();
  showToast("ğŸ—‘ Slot deleted.");
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   OVERLAY HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openOverlay(id){ document.getElementById(id).classList.add('open'); }
function closeOverlay(id){ document.getElementById(id).classList.remove('open'); }

document.querySelectorAll('.overlay').forEach(el=>{
  el.addEventListener('click', e=>{ if(e.target===el) el.classList.remove('open'); });
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showToast(msg, dur=2600){
  const t=document.getElementById('toast');
  t.textContent=msg; t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'), dur);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
render();
</script>
</body>
</html>
